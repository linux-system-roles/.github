- name: Write meta/collection-requirements.yml
  when: runtime_collection_requirements | d([]) | length > 0
  copy:
    content: |
      # DO NOT EDIT THIS FILE - managed by linux-system-roles/.github
      ---
      collections:
      {{ runtime_collection_requirements | to_nice_yaml(indent=2) | indent(width=2, first=true) }}
    dest: "{{ git_dir }}/meta/collection-requirements.yml"
    mode: "0644"
  register: meta_collection_requirements_file

- name: Add meta/collection-requirements.yml to git if changed
  command:
    cmd: git add meta/collection-requirements.yml
    chdir: "{{ git_dir }}"
  when: meta_collection_requirements_file is changed

- name: Write tests/collection-requirements.yml
  when: test_collection_requirements | d([]) | length > 0
  copy:
    content: |
      # DO NOT EDIT THIS FILE - managed by linux-system-roles/.github
      ---
      collections:
      {{ test_collection_requirements | to_nice_yaml(indent=2) | indent(width=2, first=true) }}
    dest: "{{ git_dir }}/tests/collection-requirements.yml"
    mode: "0644"
  register: tests_collection_requirements_file

- name: Add tests/collection-requirements.yml to git if changed
  command:
    cmd: git add tests/collection-requirements.yml
    chdir: "{{ git_dir }}"
  when: tests_collection_requirements_file is changed
